// Refactor contract state machine design
// Fix issues in token transfer logic
